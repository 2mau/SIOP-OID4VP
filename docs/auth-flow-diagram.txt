@startuml
header SIOP flow diagram
title
DID OpenID SIOP Flow
end title

autonumber

participant "Client\n(OP)" as OP order 0
participant "Auth API\nOPAuth" as auth1 order 1 #White
participant "Auth API\nRPAuth" as auth2 order 1 #White
participant "Web component\n(RP)" as RP order 2

OP -> auth1: HTTPS POST /authentication-requests
activate auth1
auth1 -> auth1: Create\n<Authentication Request>
auth1 -> OP: 200: <Authentication Request>
deactivate auth1

activate OP
OP -> OP: Verify\n<Authentication Request>
OP -> OP: Create\n<Authentication Response>
OP -> auth2: HTTPS POST <Authentication Response>\n/siop-sessions
deactivate OP

activate auth2
auth2 -> auth2: Verify\n<Authentication Response>
auth2 -> auth2: Create <Access Token>
OP <- auth2: 200: <Access Token>
deactivate auth2

activate OP
OP -> OP: Verify <Access Token>
deactivate OP

== Protected resources ==

OP -> RP: HTTPS POST <Access Token>\n/protected-resources

activate RP
RP -> RP: Verify\n<Access Token>
RP -> OP: 200: <response>
deactivate RP
@enduml
